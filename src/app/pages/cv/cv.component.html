<div class="cv-shell bg-white lg:bg-gray-800">
  @if (isLoading()) {
    <div class="flex min-h-screen items-center justify-center py-12">
      <p class="text-lg text-gray-600">Loading curriculum data...</p>
    </div>
  } @else if (!curriculum()) {
    <div class="flex min-h-screen items-center justify-center py-12">
      <p class="text-lg text-red-600">Failed to load curriculum data</p>
    </div>
  } @else {
    <div class="cv-frame">
      <article class="cv-page">
        <div class="flex flex-col-reverse lg:flex-row">
          
          <aside class="w-full bg-slate-700 p-8 text-white lg:w-[30%] lg:p-14">
            @if (personalInfo()?.displayPhoto !== false) {
              <div class="mb-10 flex justify-center">
                <img
                  src="assets/logos/personal-logo.jpg"
                  alt="Julian Salinas profile photo"
                  class="h-36 w-36 rounded-full border-4 border-blue-200 object-cover shadow-lg"
                />
              </div>
            }
            <div class="mb-12">
              <h2 class="mb-6 text-2xl font-bold">Contact</h2>
              <div class="mb-8 space-y-3">
                <div class="flex items-center gap-3">
                  <mat-icon class="text-blue-100">phone</mat-icon>
                  <a [href]="'tel:' + personalInfo()?.phone" class="text-white transition hover:text-blue-100">{{ personalInfo()?.phone }}</a>
                </div>
                <div class="flex items-center gap-3">
                  <mat-icon class="text-blue-100">email</mat-icon>
                  <a href="mailto:{{ personalInfo()?.email }}" class="text-white transition hover:text-blue-100">{{ personalInfo()?.email }}</a>
                </div>
                <div class="flex items-center gap-3">
                  <mat-icon class="text-blue-100">code</mat-icon>
                  <a [href]="personalInfo()?.github" target="_blank" class="text-white transition hover:text-blue-100">{{personalInfo()?.github?.replaceAll("https://","")}}</a>
                </div>
                <div class="flex items-center gap-3">
                  <mat-icon class="text-blue-100">business</mat-icon>
                  <a [href]="personalInfo()?.linkedin" target="_blank" class="text-white transition hover:text-blue-100">{{personalInfo()?.linkedin?.replaceAll("https://","")}}</a>
                </div>
              </div>
              <mat-divider class="mb-6 bg-blue-400"></mat-divider>
            </div>

            <div class="mb-12">
              <h2 class="mb-6 text-2xl font-bold">Languages</h2>
              <div class="mb-8 space-y-4">
                @for (language of languages(); track language.name) {
                  <div class="flex items-center justify-between">
                    <span class="font-semibold">{{ language.name }}</span>
                    <span class="text-sm text-blue-100">{{ language.level }}</span>
                  </div>
                }
              </div>
              <mat-divider class="mb-6 mt-6 bg-blue-400"></mat-divider>
            </div>

            <div class="mb-12">
              <h2 class="mb-6 text-2xl font-bold">Technologies</h2>
              <div class="space-y-4">
                @for (group of technologyGroups(); track group.category) {
                  <div class="mb-6">
                    <h3 class="mb-3 text-sm font-bold uppercase tracking-wide text-blue-100">{{ group.category }}</h3>
                    @for (tech of group.technologies; track tech.name) {
                      <div class="mb-4">
                        <div class="mb-2 flex items-start justify-between">
                          <span class="text-sm font-semibold">{{ tech.name }}</span>
                        </div>
                        <div class="h-4 w-full overflow-hidden rounded bg-slate-400/60">
                          <div
                            class="h-full rounded bg-amber-400"
                            [style.width.%]="tech.proficiency * 20"
                            aria-hidden="true"
                          ></div>
                        </div>
                      </div>
                    }
                  </div>
                }
              </div>
            </div>
          </aside>

          <main class="w-full bg-white p-8 lg:w-[70%] lg:p-16">
            <section class="mb-12">
              <h1 class="mb-6 text-4xl font-bold text-gray-900 lg:text-6xl">{{ personalInfo()?.name }}</h1>
              <p class="mb-6 text-2xl font-semibold text-gray-500">{{ personalInfo()?.role }}</p>
              <p class="mb-8 text-sm leading-relaxed text-gray-700">{{ personalInfo()?.profile }}</p>
              <mat-divider class="my-8"></mat-divider>
            </section>

            <section class="mb-12">
              <h2 class="mb-8 text-3xl font-bold text-gray-900">Work Experience</h2>
              <div class="relative">
                <div class="absolute bottom-0 left-3 top-0 w-px bg-gray-300"></div>
                <div class="space-y-8">
                  @for (job of visibleWorkExperience(); track job.id) {
                    <div class="relative pl-12">
                      <span class="absolute left-3 top-2 h-3.5 w-3.5 -translate-x-1/2 rounded-full bg-blue-500 ring-4 ring-blue-50"></span>
                      <div>
                        <h3 class="text-xl font-bold text-gray-900">
                          {{ job.position }}
                          @if (job.company) {
                            <span class="text-gray-600"> at {{ job.company }}</span>
                          }
                        </h3>
                        <p class="mt-1 text-sm text-gray-500">{{ job.startDate }} - {{ job.endDate }}</p>
                        @if (job.roles && job.roles.length > 0) {
                          <p class="mb-4 mt-1 text-sm text-gray-500">
                            Roles:
                            @for (role of job.roles; track role.position; let isLast = $last) {
                              <span>{{ role.position }}</span>@if (!isLast) {<span>, </span>}
                            }
                          </p>
                        } @else {
                          <div class="mb-4"></div>
                        }
                        @if (job.clientExperience && job.clientExperience.length > 0) {
                          <div class="mt-2 space-y-4">
                            @for (clientExp of job.clientExperience; track clientExp.client + clientExp.startDate + clientExp.endDate) {
                              <div class="relative">
                                <span class="absolute -left-9 top-2 h-3 w-3 -translate-x-1/2 rounded-full bg-green-500 ring-2 ring-white"></span>
                                <p class="text-sm font-semibold text-gray-700">
                                  {{ clientExp.position }} <span class="text-gray-600">at {{ clientExp.client }}</span>
                                </p>
                                <p class="mt-1 text-sm text-gray-500">{{ clientExp.startDate }} - {{ clientExp.endDate }}</p>
                                @if (clientExp.highlights.length > 0) {
                                  <div class="mt-2 space-y-1">
                                    @for (highlight of visibleHighlights(clientExp.highlights, 'job-' + job.id + '-client-' + clientExp.client + '-' + clientExp.startDate + '-' + clientExp.endDate); track highlight) {
                                      <p class="relative py-0.5 text-sm text-gray-700">
                                        <span class="absolute -left-9 top-2 h-1.5 w-1.5 -translate-x-1/2 rounded-full bg-gray-300 ring-2 ring-white"></span>
                                        {{ highlight }}
                                      </p>
                                    }
                                  </div>
                                  @if (clientExp.highlights.length > 6) {
                                    <button
                                      type="button"
                                      class="mt-1 text-sm font-semibold text-blue-600 underline transition hover:text-blue-700"
                                      (click)="toggleHighlights('job-' + job.id + '-client-' + clientExp.client + '-' + clientExp.startDate + '-' + clientExp.endDate)"
                                    >
                                      {{ isHighlightsExpanded('job-' + job.id + '-client-' + clientExp.client + '-' + clientExp.startDate + '-' + clientExp.endDate) ? 'Show less' : 'Show more' }}
                                    </button>
                                  }
                                }
                              </div>
                            }
                          </div>
                        } @else {
                          @if (job.client) {
                            <p class="mt-1 text-sm text-gray-500">Client: {{ job.client }}</p>
                          }
                          @if (job.highlights.length > 0) {
                            <div class="mt-3 space-y-1">
                              @for (highlight of visibleHighlights(job.highlights, 'job-' + job.id + '-highlights'); track highlight) {
                                <p class="relative pl-4 text-sm text-gray-700">
                                  <span class="absolute -left-9 top-2 h-2 w-2 -translate-x-1/2 rounded-full bg-gray-400 ring-2 ring-white"></span>
                                  {{ highlight }}
                                </p>
                              }
                            </div>
                            @if (job.highlights.length > 6) {
                              <button
                                type="button"
                                class="mt-1 text-sm font-semibold text-blue-600 underline transition hover:text-blue-700"
                                (click)="toggleHighlights('job-' + job.id + '-highlights')"
                              >
                                {{ isHighlightsExpanded('job-' + job.id + '-highlights') ? 'Show less' : 'Show more' }}
                              </button>
                            }
                          }
                        }
                      </div>
                    </div>
                  }
                </div>
              </div>
              @if (hasMoreWorkExperience()) {
                <div class="mt-6">
                  <button
                    type="button"
                    class="inline-flex items-center rounded-md border border-blue-300 bg-blue-50 px-4 py-2 text-sm text-blue-500 transition hover:border-blue-400 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-offset-2"
                    (click)="toggleWorkExperienceVisibility()"
                  >
                    {{ showAllWorkExperience() ? 'Collapse' : 'Expand' }}
                  </button>
                </div>
              }
            </section>

            <section class="mb-12">
              <h2 class="mb-8 text-3xl font-bold text-gray-900">Education</h2>
              <div class="grid grid-cols-1 gap-6">
                @for (edu of education(); track edu.institution) {
                  <div class="rounded-lg border border-gray-200 p-6 transition-all hover:border-blue-300 hover:shadow-lg">
                    <div class="flex items-start gap-4">
                      <div class="flex items-center justify-center overflow-hidden">
                        @if (edu.icon) {
                          <img src="{{ edu.icon }}" alt="{{ edu.institution }}" class="h-16 w-16 object-contain" />
                        } @else {
                          <mat-icon class="icon-2x text-blue-600">school</mat-icon>
                        }
                      </div>
                      <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-900">{{ edu.degree }}</h3>
                        <p class="mt-1 text-sm font-semibold text-gray-500">{{ edu.institution }}</p>
                        <div class="mt-3 border-t border-gray-100 pt-3">
                          <p class="text-sm text-gray-600">{{ edu.startDate }} - {{ edu.endDate }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </section>
            
            <section>
              <h2 class="mb-8 text-3xl font-bold text-gray-900">Certifications</h2>
              <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                @for (cert of certifications(); track cert.name) {
                  <div class="rounded-lg border border-gray-200 p-6 transition-all hover:border-blue-300 hover:shadow-lg">
                    <div class="flex items-start gap-4">
                      <div class="flex items-center justify-center overflow-hidden">
                        @if (cert.icon) {
                          <img src="{{ cert.icon }}" alt="{{ cert.issuer }}" class="h-16 w-16 object-contain" />
                        } @else {
                          <mat-icon class="icon-2x text-blue-600">verified</mat-icon>
                        }
                      </div>
                      <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-900">{{ cert.name }}</h3>
                        <div class="mt-1 flex items-center gap-2">
                          <p class="text-sm font-semibold text-gray-500">{{ cert.issuer }}</p>
                        </div>
                        <div class="mt-3 border-t border-gray-100 pt-3">
                          @if (cert.date || cert.location) {
                            <p class="text-sm text-gray-600">
                              @if (cert.date) {
                                {{ cert.date }}
                              }
                              @if (cert.date && cert.location) {
                                <span>, </span>
                              }
                              @if (cert.location) {
                                {{ cert.location }}
                              }
                            </p>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </section>
          </main>
        </div>
      </article>
    </div>
  }
</div>
